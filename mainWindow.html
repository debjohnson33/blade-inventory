<!DOCTYPE html>
<html lang="en">
<head>
	<title>Blade Inventory</title>
</head>
<body>
	<h1>Blade Inventory</h1>
	<h2>Search for Blades</h2>
	<form id="search-blades">
		<input type="text" placeholder="Search blades..." />
	</form>
	<ul></ul>

	<script>
		const electron = require('electron');
		const {ipcRenderer} = electron;
		const ul = document.querySelector('ul');
		// Load existing blades
		document.addEventListener("DOMContentLoaded", function() {
			ipcRenderer.send("mainWindowLoaded")
			ipcRenderer.on("resultSent", function(e, result){
				console.log(result);
				for (var i = 0; i < result.length; i++) {
					const li = document.createElement('li');
					const button = document.createElement('button');
					const editButton = document.createElement('button');
					editButton.innerHTML = "Edit Blade"
					editButton.className = "edit"
					button.innerHTML = "Delete Blade"
					button.className = "delete"
					li.id = result[i].stensNumber;
					const bladesText = document.createTextNode('Stens: ' + result[i].stensNumber + ' ' + 'Quantity: ' + result[i].quantity);
					li.appendChild(bladesText);
					li.appendChild(editButton);
					li.appendChild(button);
					li.addEventListener('click', deleteBlade);
					ul.appendChild(li);
				}
			})
		})
		// Add blades
		ipcRenderer.on('blades:add', function(e, stens, quantity){
			const li = document.createElement('li');
			const button = document.createElement('button');
			const editButton = document.createElement('button');
			editButton.innerHTML = "Edit Blade"
			editButton.className = "edit"
			button.innerHTML = "Delete Blade";
			button.class = "delete";
			const bladesText = document.createTextNode('Stens: ' + stens + ' ' + 'Quantity: ' + quantity);
			li.appendChild(bladesText);
			li.appendChild(editButton);
			li.addEventListener('click', deleteBlade);
			ul.appendChild(li);
		});
		// Delete blades
		//document.getElementById('delete').addEventListener('click', deleteBlade);

		function deleteBlade(e) {
			e.preventDefault();
			console.log("Called Delete")
			// let stens = document.querySelector('#stens').value;
			// Need a way to retrieve the stens number out of the text
			ipcRenderer.send('blades:delete', stens);
		}
		
		// Search for blades
		list = document.querySelector('ul');
		const searchBar = document.forms['search-blades'].querySelector('input');
		searchBar.addEventListener('keyup', (e) => {
			const term = e.target.value;
			const blades = list.getElementsByTagName('li');
			Array.from(blades).forEach((blade) => {
				const stensNumber = blade.textContent;
				if (stensNumber.indexOf(e.target.value) != -1) {
					blade.style.display = 'block';
				} else {
					blade.style.display = 'none';
				}
			})
		})
	</script>
</body>
</html>